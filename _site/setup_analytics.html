<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=ed1eb7eddc566a676d27b57ede24c49e0046e5ed" media="screen" type="text/css">
    <link rel="stylesheet" href="/assets/css/print.css" media="print" type="text/css">

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Configuração da stack de analytics | rasa-ptbr-boilerplate</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Configuração da stack de analytics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Um template para criar um FAQ chatbot usando Rasa, Rocket.chat, elastic search" />
<meta property="og:description" content="Um template para criar um FAQ chatbot usando Rasa, Rocket.chat, elastic search" />
<link rel="canonical" href="http://localhost:4000/setup_analytics.html" />
<meta property="og:url" content="http://localhost:4000/setup_analytics.html" />
<meta property="og:site_name" content="rasa-ptbr-boilerplate" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Configuração da stack de analytics" />
<script type="application/ld+json">
{"description":"Um template para criar um FAQ chatbot usando Rasa, Rocket.chat, elastic search","url":"http://localhost:4000/setup_analytics.html","@type":"WebPage","headline":"Configuração da stack de analytics","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>

  <body>
    <header>
      <div class="inner">
        <a href="http://localhost:4000/">
          <h1>rasa-ptbr-boilerplate</h1>
        </a>
        <h2>Um template para criar um FAQ chatbot usando Rasa, Rocket.chat, elastic search</h2>
        
          <a href="https://github.com/lappis-unb/rasa-ptbr-boilerplate" class="button"><small>View project on</small> GitHub</a>
        
        
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h2 id="configuração-da-stack-de-analytics">Configuração da stack de analytics</h2>
<p>Este documento tem por objetivo detalhar o processo de configuração da <em>stack</em> de <em>analytics</em> utilizada no boilerplate.</p>

<p>Aqui os passos de configuração são descritos separadamente, para facilitar o entendimento e a adaptação. Caso você já tenha executado os comandos <code class="language-plaintext highlighter-rouge">make build-analytics</code>, <code class="language-plaintext highlighter-rouge">make config-elastic</code> e <code class="language-plaintext highlighter-rouge">make config-kibana</code>, não é necessário executar os passos abaixo, e o <em>analytics</em> já deve estar funcionando para o seu <em>bot</em>.</p>

<h4 id="rabbitmq">RabbitMQ</h4>

<h6 id="configuração-do-server-e-dos-consumers">Configuração do <em>server</em> e dos <em>consumers</em></h6>
<p>Em primeiro lugar para fazer o setup do analytics é necessário subir o RabbitMQ e definir suas configurações.</p>

<p>Inicie o serviço do servidor do RabbitMQ:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker-compose up <span class="nt">-d</span> rabbitmq
</code></pre></div></div>

<p>Inicie o serviço do consumidor do RabbitMQ, que ficará responsável por enviar as mensagens para o ElasticSearch:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker-compose up <span class="nt">-d</span> rabbitmq-consumer
</code></pre></div></div>

<p>Lembre-se de configurar as credenciais de acesso do <em>server</em> e dos <em>consumers</em> do <code class="language-plaintext highlighter-rouge">rabbitmq</code>, nos arquivos <code class="language-plaintext highlighter-rouge">env/rabbitmq.env</code> e <code class="language-plaintext highlighter-rouge">env/rabbitmq-consumer.env</code>. Estas credenciais devem ser as mesmas, para que estes serviços consigam se integrar corretamente:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">RABBITMQ_DEFAULT_USER</span><span class="o">=</span>admin
<span class="nv">RABBITMQ_DEFAULT_PASS</span><span class="o">=</span>admin
</code></pre></div></div>

<h6 id="integração-com-rasa">Integração com Rasa</h6>

<p>Cada mensagem trocada com o <em>bot</em> será enviada à uma fila no servidor do <em>RabbitMQ</em>, para isso, é precisso integrar esses dois serviços.
Isso é feito definindo as configurações de <em>broker</em> do Rasa no arquivo <code class="language-plaintext highlighter-rouge">bot/endpoints.yml</code>:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">event_broker</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">pika</span>
  <span class="na">url</span><span class="pi">:</span> <span class="s">rabbitmq</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">admin</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">admin</span>
  <span class="na">queues</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">bot_messages</span>
</code></pre></div></div>

<h4 id="configuração-elasticsearch">Configuração ElasticSearch</h4>

<p>O ElasticSearch é o serviço responsável por armazenar os dados provenientes da interação entre o usuário e o chatbot.</p>

<p>As mensagens são inseridas no índice do ElasticSearch utilizando o <em>broker</em> RabbitMQ.</p>

<p>Para subir o ambiente do ElasticSearch rode os seguintes comandos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker-compose up -d elasticsearch
sudo docker-compose run --rm -v $(pwd)/modules/analytics:/analytics bot python /analytics/setup_elastic.py
</code></pre></div></div>

<p>Lembre-se de setar as seguintes variaveis de ambiente no <code class="language-plaintext highlighter-rouge">docker-compose</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ENVIRONMENT_NAME=localhost
BOT_VERSION=last-commit-hash
</code></pre></div></div>

<h4 id="configuração-kibana-visualização">Configuração Kibana (Visualização)</h4>

<p>Para a análise dos dados das conversas com o usuário, utilize o kibana, e veja como os usuários estão interagindo com o bot, os principais assuntos, média de usuários e outras informações da análise de dados.</p>

<p>O Kibana nos auxilia com uma interface para criação de visualização para os dados armazenados nos índices do ElasticSearch.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>docker-compose up <span class="nt">-d</span> kibana
</code></pre></div></div>

<p><strong>Atenção:</strong> Caso queira configurar permissões diferentes de usuários (Login) no ElasticSearch/Kibana, siga esse tutorial (<a href="https://github.com/lappis-unb/rasa-ptbr-boilerplate/tree/master/docs/setup_user_elasticsearch.md">link</a>).</p>

<h6 id="importação-de-dashboards">Importação de dashboards</h6>

<p>Caso queira subir com os dashboards que criamos para fazer o monitoramento de bots:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker-compose run --rm -v $(pwd)/modules/analytics/:/analytics/ kibana python3 /analytics/import_dashboards.py
</code></pre></div></div>

<p>Você pode acessar o kibana na url <code class="language-plaintext highlighter-rouge">localhost:5601</code></p>

        </section>

        <aside id="sidebar">
          

          
            <p class="repo-owner"><a href="https://github.com/lappis-unb/rasa-ptbr-boilerplate">rasa-ptbr-boilerplate</a> is maintained by <a href="https://github.com/lappis-unb">lappis-unb</a>.</p>
          
          
              <h2><a href="/">Home</a></h2>
                
          
              <h2><a href="/assets/css/style.css"></a></h2>
                
          
              <h2><a href="/assets/css/print.css"></a></h2>
                
          
              <h2><a href="/README-en.html">Rasa Boilerplate</a></h2>
                
          
              <h2><a href="/pipeline-de-qualidade.html">Qualidade do bot</a></h2>
                
          
              <h2><a href="/setup_analytics.html">Configuração da stack de analytics</a></h2>
                
          
              <h2><a href="/setup_telegram.html">Setup do bot no Telegram</a></h2>
                
          
              <h2><a href="/setup_user_elasticsearch.html">Configurando os usuários</a></h2>
                
          
              <h2><a href="/tutorial-add-bot-rocketchat.html">Adicionar bot ao RocketChat</a></h2>
                
          
              <h2><a href="/tutorial-como-contribuir-com-documentacao.html">Contribuir com a Documentação</a></h2>
                
          
              <h2><a href="/tutorial-como-criar-uma-action.html">Criação de Actions</a></h2>
                
          
              <h2><a href="/tutorial-como-fazer-uma-utter.html">Criação de Utter</a></h2>
                
          
              <h2><a href="/tutorial-como-treinar-o-modelo.html">Configuração da Policy do chatbot</a></h2>
                
          
              <h2><a href="/tutorial-criar-BI.html">Criação de visualizações no Kibana</a></h2>
                
          
              <h2><a href="/tutorial-pipeline-de-bot.html">Configuração pipeline de bot</a></h2>
                
          
              <h2><a href="/tutorial-primeira-conversa.html">Primeira Conversa</a></h2>
                
          
              <h2><a href="/tutorial-testes-automatizados.html">Criação de Testes Automatizados</a></h2>
                
          

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</p>
        </aside>
      </div>
    </div>

    <script>!(function () {
    let e = document.createElement("script"),
      t = document.head || document.getElementsByTagName("head")[0];
    (e.src =
      "assets/1.0.1.min.js"),
      (e.async = !0),
      (e.onload = () => {
        window.WebChat.default(
          {
            customData: { language: "pt-br" },
            selector: "#webchat",
            initPayload: "/cumprimentar",
            socketUrl: "http://localhost:5007",
            socketPath: "/socket.io/",
            title: "Tais",
            inputTextFieldHint: "Digite sua mensagem...",
            connectingText: "Conectando...",
            hideWhenNotConnected: true,
            fullScreenMode: false,
            profileAvatar: "assets/images/bot.png",
            openLauncherImage: 'assets/images/launcher_button.svg',
            closeLauncherImage: 'assets/images/launcher_button.svg',
            params: {
                images: {
                    dims: {
                        width: 300,
                        height: 200,
                    }
                },
                storage: "session"
            }
          },
          null
        );
      }),
      t.insertBefore(e, t.firstChild);
    })();
    </script>

  </body>
</html>
